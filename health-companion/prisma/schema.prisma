generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ChatMessage {
  id          String      @id
  role        String
  content     String
  citations   Json?
  createdAt   DateTime    @default(now())
  sessionId   String
  ChatSession ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
}

model ChatSession {
  id                String        @id
  ondemandSessionId String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime
  userId            String
  ChatMessage       ChatMessage[]
  User              User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model EmergencyContact {
  id           String   @id
  name         String
  phone        String
  email        String?
  relationship String?
  createdAt    DateTime @default(now())
  userId       String
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model HealthLog {
  id        String     @id
  symptoms  Json
  vitals    Json?
  lifestyle Json?
  createdAt DateTime   @default(now())
  userId    String
  User      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  RiskAlert RiskAlert?
}

model Reminder {
  id              String       @id
  type            ReminderType
  title           String
  schedule        Json
  enabled         Boolean      @default(true)
  lastTriggeredAt DateTime?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime
  userId          String
  User            User         @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Report {
  id            String   @id
  fileName      String
  mimeType      String
  size          Int
  storageKey    String
  reportType    String?
  extractedText String?
  createdAt     DateTime @default(now())
  userId        String
  User          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model RiskAlert {
  id            String    @id
  riskLevel     RiskLevel
  reasons       String[]
  nextSteps     String[]
  redFlags      String[]
  consultAdvice String?
  ruleVersion   String    @default("1.0")
  createdAt     DateTime  @default(now())
  healthLogId   String    @unique
  HealthLog     HealthLog @relation(fields: [healthLogId], references: [id], onDelete: Cascade)
}

model User {
  id                String             @id
  email             String             @unique
  passwordHash      String
  name              String?
  profile           Json?
  consentAcceptedAt DateTime?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime
  ChatSession       ChatSession[]
  EmergencyContact  EmergencyContact[]
  HealthLog         HealthLog[]
  Reminder          Reminder[]
  Report            Report[]
}

enum ReminderType {
  MEDICINE
  WATER
  SLEEP
  CUSTOM
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
  EMERGENCY
}
